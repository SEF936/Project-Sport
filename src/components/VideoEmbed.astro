---
export interface Props {
  videoUrl: string;
  title?: string;
}

const { videoUrl, title = "Vid√©o de conseil" } = Astro.props;

// Helper to convert YouTube URLs to embed format
function normalizeYouTubeUrl(url: string): string {
  // Handle various YouTube URL formats
  if (!url) return '';
  
  // If it's already an embed URL, return as is
  if (url.includes('youtube.com/embed/')) return url;
  
  // youtube.com/watch?v=ID format
  const watchMatch = url.match(/youtube\.com\/watch\?v=([a-zA-Z0-9_-]{11})/);
  if (watchMatch) return `https://www.youtube.com/embed/${watchMatch[1]}`;
  
  // youtu.be/ID format
  const shortMatch = url.match(/youtu\.be\/([a-zA-Z0-9_-]{11})/);
  if (shortMatch) return `https://www.youtube.com/embed/${shortMatch[1]}`;
  
  // youtube.com/shorts/ID format
  const shortsMatch = url.match(/youtube\.com\/shorts\/([a-zA-Z0-9_-]{11})/);
  if (shortsMatch) return `https://www.youtube.com/embed/${shortsMatch[1]}`;
  
  // If it doesn't match any pattern but starts with http, return as is (might be Vimeo or other)
  if (url.startsWith('http')) return url;
  
  // If it's just an ID, construct the embed URL
  if (url.length === 11 && /^[a-zA-Z0-9_-]+$/.test(url)) {
    return `https://www.youtube.com/embed/${url}`;
  }
  
  return url;
}

const embedUrl = normalizeYouTubeUrl(videoUrl);
---

{embedUrl && (
  <div class="mb-12">
    <div class="relative w-full" style="padding-bottom: 56.25%;">
      <iframe
        class="absolute inset-0 w-full h-full rounded-lg"
        src={embedUrl}
        title={title}
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
        loading="lazy"
      ></iframe>
    </div>
    <p class="text-slate-400 text-sm mt-3 italic">{title}</p>
  </div>
)}
